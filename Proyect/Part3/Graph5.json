{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "config": {
    "view": { "stroke": "transparent" },
    "title": { "fontSize": 18, "subtitleFontSize": 14 },
    "legend": {
      "titleFontSize": 14,
      "labelFontSize": 12,
      "titleLimit": 260,
      "labelLimit": 260
    }
  },
  "vconcat": [
    {
      "width": 700,
      "height": 400,
      "title": {
        "text": "Births by Mother’s Labour-Market Status in Chile",
        "subtitle": "Share of births among active vs inactive mothers (2010–2022)",
        "anchor": "start"
      },
      "data": {
        "url": "https://raw.githubusercontent.com/CarolinaMolinare/CarolinaMolinare.github.io/refs/heads/main/Proyect/Part3/Labor.csv",
        "format": { "type": "dsv", "delimiter": ";" }
      },
      "transform": [
        { "fold": ["Active", "Inactive", "NA"], "as": ["Status", "Births_raw"] },
        {
          "calculate": "toNumber(replace(replace(replace(toString(datum.Births_raw), '\\u00a0', ''), '.', ''), ',', ''))",
          "as": "Births"
        },
        { "filter": "isValid(datum.Year) && isValid(datum.Births)" },
        { "filter": "datum.Status != 'NA'" },
        {
          "joinaggregate": [
            { "op": "sum", "field": "Births", "as": "Total_known" }
          ],
          "groupby": ["Year"]
        },
        { "calculate": "datum.Births / datum.Total_known", "as": "Share" }
      ],
      "layer": [
        {
          "mark": { "type": "area" },
          "encoding": {
            "x": {
              "field": "Year",
              "type": "ordinal",
              "title": "",
              "axis": { "labelAngle": 0 }
            },
            "y": {
              "field": "Share",
              "type": "quantitative",
              "title": "Share of births (Active + Inactive = 100%)",
              "axis": { "format": "%" },
              "scale": { "domain": [0, 1] }
            },
            "color": {
              "field": "Status",
              "type": "nominal",
              "scale": {
                "domain": ["Active", "Inactive"],
                "range": ["#1B5E20", "#66BB6A"]
              },
              "legend": { "title": "" }
            }
          }
        },
        {
          "transform": [
            { "calculate": "toString(datum.Year)", "as": "YearLabel" },
            { "pivot": "Status", "value": "Share", "groupby": ["Year", "YearLabel"] }
          ],
          "mark": { "type": "point", "opacity": 0 },
          "encoding": {
            "x": { "field": "Year", "type": "ordinal" },
            "tooltip": [
              { "field": "YearLabel", "type": "nominal", "title": "Year" },
              { "field": "Active", "type": "quantitative", "title": "Active (share)", "format": ".1%" },
              { "field": "Inactive", "type": "quantitative", "title": "Inactive (share)", "format": ".1%" }
            ]
          },
          "params": [
            {
              "name": "hover",
              "select": {
                "type": "point",
                "fields": ["Year"],
                "nearest": true,
                "on": "pointerover",
                "clear": "pointerout"
              }
            }
          ]
        },
        {
          "transform": [
            { "calculate": "toString(datum.Year)", "as": "YearLabel" },
            { "pivot": "Status", "value": "Share", "groupby": ["Year", "YearLabel"] },
            { "filter": { "param": "hover", "empty": false } }
          ],
          "mark": { "type": "rule", "color": "gray", "strokeWidth": 1 },
          "encoding": { "x": { "field": "Year", "type": "ordinal" } }
        }
      ]
    },
    {
      "width": 700,
      "height": 18,
      "data": {
        "values": [
          {
            "note": "Note: “Not specified” (NA) cases are excluded. Shares are computed over births with recorded labour-market status (Active + Inactive = 100%)."
          }
        ]
      },
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "top",
        "fontSize": 12,
        "color": "gray",
        "fontWeight": "normal"
      },
      "encoding": {
        "x": { "value": 0 },
        "y": { "value": 0 },
        "text": { "field": "note" }
      },
      "view": { "stroke": "transparent" }
    },
    {
      "width": 700,
      "height": 20,
      "data": { "values": [{ "source": "Source: Vital Statistics, National Institute of Statistics (INE)." }] },
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "top",
        "fontSize": 12,
        "color": "gray",
        "fontWeight": "normal"
      },
      "encoding": {
        "x": { "value": 0 },
        "y": { "value": 0 },
        "text": { "field": "source" }
      }
    }
  ],
  "spacing": 8
}
